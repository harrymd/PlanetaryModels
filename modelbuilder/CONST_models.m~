% create the model files 
fname = [fmesh,'.1']; 
tic
pOrder  = 2;

fmid    = ['_pod_',int2str(pOrder),'_'];
% true model filenames
ftail   = 'true.dat';
fvp     = [fname,'_vp', fmid,ftail];
fvs     = [fname,'_vs', fmid,ftail];
frho    = [fname,'_rho',fmid,ftail];
%fvpvtk  = [fname,'_vp', fmid,'true.vtk'];
%fvsvtk  = [fname,'_vs', fmid,'true.vtk'];
%frhovtk = [fname,'_rho',fmid,'true.vtk'];
fvtk = [fname,fmid,'model.vtk'];

accry = 'float64';

pNp = (pOrder+1)*(pOrder+2)*(pOrder+3)/6;
[x,y,z,tet] = construct(fname,pOrder);


if 1
vp0  = zeros(pNp,size(tet,1)); 
vp0(:) = 10.000;
fid=fopen(fvp,'w');
fwrite(fid,vp0(:),accry);

vp = vp0(tet);
%clear vp

vs0  = zeros(pNp,size(tet,1)); 
vs0(:) = 10.000/sqrt(3.0);
fid=fopen(fvs,'w');
fwrite(fid,vs0(:),accry);

vs = vs0(tet);
%clear vs

rho0 = zeros(pNp,size(tet,1)); 
rho0(:) = 5.5100;
fid=fopen(frho,'w');
fwrite(fid,rho0(:),accry);
fclose(fid);

rho = rho0(tet);
%clear rho

toc

% setup filename
filename = fvtk;
data_title = 'CONST';
% organize data
% .type field must be 'scalar' or 'vector'
% number of vector components must equal dimension of the mesh
data_struct(1).type = 'scalar';
data_struct(1).name = 'Vp';
data_struct(1).data = vp(:);

data_struct(2).type = 'scalar';
data_struct(2).name = 'Vs';
data_struct(2).data = vs(:);

data_struct(3).type = 'scalar';
data_struct(3).name = 'Density';
data_struct(3).data = rho(:);

flipped = false;
% otherwise, if you want to transpose the data, then set this to *true*
%tnew = reshape(1:size(tout,1)*size(tout,2),size(tout,2),size(tout,1));
psiz = size(tet,1)*size(tet,2);
pnew = zeros(psiz,3);
pnew(:,1) = reshape(x(tet),psiz,1); 
pnew(:,2) = reshape(x(tet),psiz,1); 
pnew(:,3) = z(tet);  
 
% write the file
stat = vtk_write_tetrahedral_grid_and_data(filename,data_title,pnew,...
    tet,data_struct,flipped);
toc
end

